<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Using Opal with Sinatra</title>

  <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/application.js" type="text/javascript"></script>
</head>
<body>
  <nav class="navbar navbar-default opal-nav" role="navigation">
  <a href="https://github.com/opal/opal"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
  <div class="container">

    <div class="navbar-header">
      <a class="navbar-brand" href="/">
        <img height='22' width='22' style='margin-top:-10%;' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png'/>
        Opal
      </a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/docs">Documentation</a></li>
        <li><a href="/try">Try Opal online!</a></li>
        <li class="divider-vertical"></li>
        <li><p class="navbar-text"><span class="label">integrations:</span></p></li>
        <li><a href="http://github.com/opal/opal-jquery">jQuery</a></li>
        <li><a href="https://github.com/opal/opal-rails#readme">Rails</a></li>
        <li><a href="https://github.com/opal/opal-rspec#readme">RSpec</a></li>
        <li><a href="https://github.com/opal/vienna#readme">Vienna</a></li>
        <li><a href="https://github.com/opal/opal-node#readme">Nodejs / RVM</a></li>
        <li><a href="https://github.com/opal/opal-todos#readme">TodoMVC</a></li>
      </ul>
    </div>

  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <ul class="nav opal-sidebar">
        
          <li>
            <a href="/docs">Getting Started</a>
            
              <ul class="nav">
              
                <li><a href="/docs/rails">Rails</a></li>
              
                <li><a href="/docs/sinatra">Sinatra</a></li>
              
                <li><a href="/docs/using_sprockets">Sprockets</a></li>
              
                <li><a href="/docs/static_applications">Static Applications</a></li>
              
              </ul>
            
          </li>
        
          <li>
            <a href="/docs/features">Features</a>
            
              <ul class="nav">
              
                <li><a href="/docs/generated_javascript">Generated Code</a></li>
              
                <li><a href="/docs/method_missing"><tt>#method_missing</tt> support</a></li>
              
                <li><a href="/docs/interacting_with_javascript">Interacting with javascript</a></li>
              
                <li><a href="/docs/using_ruby_from_javascript">Accessing Ruby methods</a></li>
              
              </ul>
            
          </li>
        
          <li>
            <a href="/docs/libraries">Libraries</a>
            
              <ul class="nav">
              
                <li><a href="/docs/templates">Templates (Haml and ERB)</a></li>
              
                <li><a href="/docs/jquery">JQuery</a></li>
              
                <li><a href="/docs/rspec">RSpec</a></li>
              
              </ul>
            
          </li>
        
          <li>
            <a href="/docs/compiler">Compiler</a>
            
          </li>
        
          <li>
            <a href="/docs/faq">FAQ</a>
            
          </li>
        
        </ul>
      </div>

      <div class="col-md-9">
        <h1>Opal in a Sinatra application</h1>

<p>Add Opal to your Gemfile (or install using <code>gem</code>):</p>
<pre class="highlight ruby"><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">&#39;sinatra&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;opal&#39;</span>
</pre>
<p>Opal uses <code>sprockets</code> as its default build system, so the asset-pipeline
from rails can be mimicked here to map all ruby assets in the <code>/assets</code>
path to be compiled using opal.</p>

<h2>Basic Application</h2>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;opal&#39;</span>

<span class="n">map</span> <span class="s1">&#39;/assets&#39;</span> <span class="k">do</span>
  <span class="n">env</span> <span class="o">=</span> <span class="no">Opal</span><span class="o">::</span><span class="no">Environment</span><span class="nf">.new</span>
  <span class="n">env</span><span class="nf">.append_path</span> <span class="s1">&#39;opal&#39;</span>
  <span class="n">run</span> <span class="n">env</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
  <span class="o">&lt;&lt;-</span><span class="no">HTML</span><span class="sh">
    &lt;!doctype html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;script src=&quot;/assets/application.js&quot;&gt;&lt;/script&gt;
      &lt;/head&gt;
    &lt;/html&gt;
</span><span class="no">  HTML</span>
<span class="k">end</span>

<span class="n">run</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Application</span>
</pre>
<p>This creates a simple sprockets instance under the <code>/assets</code> path. Opal
uses a set of load paths to compile assets using sprockets. The
<code>Opal::Environment</code> instance is a simple subclass of <code>Sprockets::Environment</code>
with all the custom opal paths added automatically.</p>

<p>This <code>env</code> object includes all the opal corelib and stdlib paths. To add
any custom application directories, you must add them to the load path using
<code>env.append_path</code>. You can now add an <code>opal/application.rb</code> file into this
added path with some basic content:</p>
<pre class="highlight ruby"><span class="c1"># opal/application.rb</span>
<span class="nb">require</span> <span class="s1">&#39;opal&#39;</span>

<span class="nb">puts</span> <span class="s2">&quot;wow, running ruby!&quot;</span>
</pre>
<p>It is necessary to require the opal corelib (seen in the <code>require</code> call) above.
This just makes the Opal runtime and corelib available. Then it is possible to
use all the corelib methods and classes, e.g. <code>Kernel#puts</code> as seen above.</p>

<h3>Running Application</h3>

<p>As this is just a simple sinatra application, you can run it:</p>
<pre class="highlight shell"><span class="gp">$ </span>bundle <span class="nb">exec </span>rackup
</pre>
<p>And point your browser towards <code>http://localhost:9292/</code> and view the browser
debug console. You should see this message printed.</p>

      </div>
    </div>
  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  <a href="/license">License</a> Â·
  <a href="https://github.com/opal/opal/graphs/contributors">Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
