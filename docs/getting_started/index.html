<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Getting started with Opal</title>

  <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/application.js" type="text/javascript"></script>
</head>
<body>
  <nav class="navbar navbar-default opal-nav" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <a class="navbar-brand" href="/">
        <img height='22' width='22' style='margin-top:-10%;' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png'/>
        Opal
      </a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/docs">Documentation</a></li>
        <li><a href="/try">Try Opal online!</a></li>
        <li class="divider-vertical"></li>
        <li><p class="navbar-text"><span class="label">integrations:</span></p></li>
        <li><a href="http://github.com/opal/opal-jquery">jQuery</a></li>
        <li><a href="https://github.com/opal/opal-rails#readme">Rails</a></li>
        <li><a href="https://github.com/opal/opal-rspec#readme">RSpec</a></li>
        <li><a href="https://github.com/opal/vienna#readme">Vienna</a></li>
        <li><a href="https://github.com/opal/opal-node#readme">Nodejs / RVM</a></li>
        <li><a href="https://github.com/opal/opal-todos#readme">TodoMVC</a></li>
      </ul>
    </div>

  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <ul class="nav nav-pills nav-stacked">
          <li><a href="/docs">Opal</a></li>
          <li><a href="/docs/getting_started">Getting Started</a></li>
          <li><a href="/docs/generated_javascript">Generated Code</a></li>
          <li><a href="/docs/method_missing"><tt>#method_missing </tt> support</a></li>
          <li><a href="/docs/using_ruby_from_javascript">Accessing Ruby methods</a></li>
          <li><a href="/docs/using_sprockets">Sprockets Integration</a></li>
          <li><a href="/docs/static_applications">Building Static Apps</a></li>
        </ul>
      </div>

      <div class="col-md-9">
        <h1>Getting started with Opal</h1>

<p>At its very core, opal provides a simple method of compiling a string of ruby
into javascript that can run on top of the opal runtime, provided by opal.js:</p>
<pre class="highlight ruby"><span class="no">Opal</span><span class="nf">.compile</span><span class="p">(</span><span class="s2">&quot;[1, 2, 3].each { |a| puts a }&quot;</span><span class="p">)</span>
<span class="c1"># =&gt; &quot;(function() { ... })()&quot;</span>
</pre>
<p><code>opal-sprockets</code> adds support to sprockets for compiling ruby (and erb) assets,
and treating them as first class javascript citizens. It works in a similar way
to coffeescript, where javascript files can simply <code>require</code> ruby sources, and
ruby sources can <code>require</code> javascript and other ruby files.</p>

<p>This relies on the opal load path. Any gem containing opal code registers that
directory to the opal load path. <code>opal-sprockets</code> will then use all opal load
paths when running sprockets instances. For rails applications,
<a href="http://github.com/opal/opal-rails">opal-rails</a> does this automatically. For
building a simple application, we have to do this manually. So add opal-sprockets
to a <code>Gemfile</code> to get started:</p>
<pre class="highlight ruby"><span class="c1"># Gemfile</span>
<span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;opal&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;opal-sprockets&#39;</span>
</pre>
<p>Next, we can use sprockets inside a simple rack app to get assets automatically
re-compiling between page loads. Add this to a <code>config.ru</code>:</p>
<pre class="highlight ruby"><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">&#39;bundler&#39;</span>
<span class="no">Bundler</span><span class="nf">.require</span>

<span class="n">run</span> <span class="no">Opal</span><span class="o">::</span><span class="no">Server</span><span class="nf">.new</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="c1"># the entry-point (main) to the app</span>
  <span class="n">s</span><span class="nf">.main</span> <span class="o">=</span> <span class="s1">&#39;application&#39;</span>

  <span class="c1"># add additional dirs to opal/sprockets load path</span>
  <span class="n">s</span><span class="nf">.append_path</span> <span class="s1">&#39;app&#39;</span>
<span class="p">}</span>
</pre>
<p>Next, we must make our main app file <code>app/application.rb</code>:</p>
<pre class="highlight ruby"><span class="c1"># app/application.rb</span>

<span class="c1"># when using sprockets/rails, we must include the corelib</span>
<span class="nb">require</span> <span class="s1">&#39;opal&#39;</span>

<span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="nf">.each</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">a</span> <span class="p">}</span>
</pre>
<p>To run the application, start the rack server:</p>
<pre class="highlight text">bundle exec rackup
</pre>
<p>Next, open <code>http://localhost:9292</code> in any web browser. If you view the development
console, you should see the three numbers printed.</p>

<h2>Adding more ruby sources</h2>

<p>If you are familiar with sprockets, adding more ruby files should be simple. Add
an <code>app/user.rb</code> file to the mix:</p>
<pre class="highlight ruby"><span class="c1"># app/user.rb</span>
<span class="k">class </span><span class="nc">User</span>
  <span class="k">def </span><span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>

  <span class="k">def </span><span class="nf">admin?</span>
    <span class="vi">@name</span> <span class="o">==</span> <span class="s2">&quot;Adam&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>And include it in your application:</p>
<pre class="highlight ruby"><span class="c1"># app/application.rb</span>
<span class="nb">require</span> <span class="s1">&#39;opal&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;user&#39;</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="nf">.new</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">user</span><span class="nf">.admin?</span>
<span class="c1"># =&gt; false</span>
</pre>
<p>Simply refresh the page in the browser, and view the console.</p>

<h2>Custom html</h2>

<p><code>Opal::Server</code> provides a default html page for content. You can just create
an <code>index.html</code> or <code>index.html.erb</code> page to have custom html content. The
<code>javascript_include_tag</code> helpers acts just like in rails:</p>
<pre class="highlight erb"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>opal demo<span class="nt">&lt;/title&gt;</span>

    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">&#39;application&#39;</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>
<h2>Using jQuery with Opal</h2>

<p><code>opal-jquery</code> provides a nice clean wrapper around jquery for dom interaction.
Add the gem to your Gemfile:</p>
<pre class="highlight ruby"><span class="c1"># Gemfile</span>
<span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;opal&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;opal-sprockets&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;opal-jquery&#39;</span>
</pre>
<p>Also, add some jquery code:</p>
<pre class="highlight ruby"><span class="c1"># app/application.rb</span>

<span class="nb">require</span> <span class="s1">&#39;opal&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;jquery&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;opal-jquery&#39;</span>

<span class="no">Document</span><span class="nf">.ready?</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">&quot;jquery is ready!&quot;</span>
<span class="k">end</span>
</pre>
<p><strong>Note</strong>: you must supply your own version of jquery, as opal-jquery just wraps
and existing instance. Place <code>jquery.js</code> into <code>app/</code> for the require system to
find it. You can also use <code>Zepto</code> instead.</p>

<p>Restart the server, and visit the page! Go to the
<a href="http://github.com/opal/opal-jquery">opal-jquery homepage</a> for more documentation.</p>

      </div>
    </div>
  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  <a href="/license">License</a> ·
  <a href="https://github.com/opal/opal/graphs/contributors">Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')
  </script>
</body>
</html>
