<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Generated Javascript</title>

  <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" type="text/css" />
  <script src="/javascripts/application.js" type="text/javascript"></script>
</head>
<body class="docs docs_generated_javascript docs_generated_javascript_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png' style='margin-top:-10%;' width='22'>
        Opal
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='/try'>
            <i class='ion-ios7-compose'></i>
            Try
          </a>
        </li>
        <li>
          <a href='/blog'>
            <i class='ion-ios7-chatboxes'></i>
            Blog
          </a>
        </li>
        <li>
          <a href='/docs'>
            <i class='ion-ios7-copy'></i>
            Documentation
          </a>
        </li>
        <li>
          <a href='/libraries'>
            <i class='ion-android-developer'></i>
            Libraries
          </a>
        </li>
        <li>
          <a href='https://github.com/opal/opal#readme'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-md-3">
        <ul class="nav opal-sidebar">
          <li>
            <a href="/docs">Getting Started</a>
              <ul class="nav">
                <li><a href="/docs/rails">Rails</a></li>
                <li><a href="/docs/sinatra">Sinatra</a></li>
                <li><a href="/docs/using_sprockets">Sprockets</a></li>
                <li><a href="/docs/static_applications">Static Applications</a></li>
                <li><a href="/docs/cdn_distribution">CDN Distribution</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/api">API documentation</a>
          </li>
          <li>
            <a href="/docs/digging_deeper">Digging Deeper</a>
              <ul class="nav">
                <li><a href="/docs/interacting_with_javascript">Interacting with javascript</a></li>
                <li><a href="/docs/generated_javascript">Generated Code</a></li>
                <li><a href="/docs/method_missing"><tt>#method_missing</tt> support</a></li>
                <li><a href="/docs/using_ruby_from_javascript">Accessing Ruby methods</a></li>
                <li><a href="/docs/compiler">Compiler</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/libraries">Libraries</a>
              <ul class="nav">
                <li><a href="/docs/templates">Templates (Haml and ERB)</a></li>
                <li><a href="/docs/jquery">JQuery</a></li>
                <li><a href="/docs/rspec">RSpec</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/faq">FAQ</a>
          </li>
        </ul>
      </div>

      <div class="col-md-9">
        <h1>Generated Javascript</h1>

<p>Opal is a source-to-source compiler, so there is no VM as such and the
compiled code aims to be as fast and efficient as possible, mapping
directly to underlying javascript features and objects where possible.</p>

<h2>Literals</h2>

<p><strong>self</strong> is mostly compiled to <code>this</code>. Methods and blocks are implemented
as javascript functions, so their <code>this</code> value will be the right
<code>self</code> value. Class bodies and the top level scope use a <code>self</code> variable
to improve readability.</p>

<p><strong>true</strong> and <strong>false</strong> are compiled directly into their native boolean
equivalents. This makes interaction a lot easier as there is no need
to convert values to opal specific values. It does mean that there is
only a <code>Boolean</code> ruby class available, not seperate <code>TrueClass</code> and
<code>FalseClass</code> classes.</p>

<p><strong>nil</strong> is compiled to a <code>nil</code> javascript variable. <code>nil</code> is a real object
which allows methods to be called on it. Opal cannot send methods to <code>null</code>
or <code>undefined</code>, and they are considered bad values to be inside ruby code.</p>
<pre class="highlight ruby"><span class="kp">nil</span>         <span class="c1"># =&gt; nil</span>
<span class="kp">true</span>        <span class="c1"># =&gt; true</span>
<span class="kp">false</span>       <span class="c1"># =&gt; false</span>
<span class="nb">self</span>        <span class="c1"># =&gt; self</span>
</pre>

<h5>Strings</h5>

<p>Ruby strings are compiled directly into javascript strings for
performance as well as readability. This has the side effect that Opal
does not support mutable strings - i.e. all strings are immutable.</p>

<h5>Symbols</h5>

<p>For performance reasons, symbols compile directly into strings. Opal
supports all the symbol syntaxes, but does not have a real <code>Symbol</code>
class. Symbols and Strings can therefore be used interchangeably.</p>
<pre class="highlight ruby"><span class="s2">"hello world!"</span>    <span class="c1"># =&gt; "hello world!"</span>
<span class="ss">:foo</span>              <span class="c1"># =&gt; "foo"</span>
<span class="o">&lt;&lt;-</span><span class="no">EOS</span>            <span class="c1"># =&gt; "\nHello there.\n"</span><span class="sh">
Hello there.
</span><span class="no">EOS</span>
</pre>

<h5>Numbers</h5>

<p>In Opal there is a single class for numbers; <code>Numeric</code>. To keep opal
as performant as possible, ruby numbers are mapped to native numbers.
This has the side effect that all numbers must be of the same class.
Most relevant methods from <code>Integer</code>, <code>Float</code> and <code>Numeric</code> are
implemented on this class.</p>
<pre class="highlight ruby"><span class="mi">42</span>        <span class="c1"># =&gt; 42</span>
<span class="mi">3</span><span class="o">.</span><span class="mi">142</span>     <span class="c1"># =&gt; 3.142</span>
</pre>

<h5>Arrays</h5>

<p>Ruby arrays are compiled directly into javascript arrays. Special
ruby syntaxes for word arrays etc are also supported.</p>
<pre class="highlight ruby"><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span>        <span class="c1"># =&gt; [1, 2, 3, 4]</span>
<span class="sx">%w[foo bar baz]</span>     <span class="c1"># =&gt; ["foo", "bar", "baz"]</span>
</pre>

<h5>Hash</h5>

<p>Inside a generated ruby script, a function <code>__hash</code> is available which
creates a new hash. This is also available in javascript as <code>Opal.hash</code>
and simply returns a new instance of the <code>Hash</code> class.</p>
<pre class="highlight ruby"><span class="p">{</span> <span class="ss">:foo</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="ss">:baz</span> <span class="o">=&gt;</span> <span class="mi">700</span> <span class="p">}</span>    <span class="c1"># =&gt; __hash("foo", 100, "baz", 700)</span>
<span class="p">{</span> <span class="ss">foo: </span><span class="mi">42</span><span class="p">,</span> <span class="ss">bar: </span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span> <span class="p">}</span>     <span class="c1"># =&gt; __hash("foo", 42, "bar", [1, 2, 3])</span>
</pre>

<h5>Range</h5>

<p>Similar to hash, there is a function <code>__range</code> available to create
range instances.</p>
<pre class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">4</span>        <span class="c1"># =&gt; __range(1, 4, true)</span>
<span class="mi">3</span><span class="p">.</span><span class="nf">.</span><span class="o">.</span><span class="mi">7</span>       <span class="c1"># =&gt; __range(3, 7, false)</span>
</pre>

<h2>Logic and conditionals</h2>

<p>As per ruby, Opal treats only <code>false</code> and <code>nil</code> as falsy, everything
else is a truthy value including <code>&quot;&quot;</code>, <code>0</code> and <code>[]</code>. This differs from
javascript as these values are also treated as false.</p>

<p>For this reason, most truthy tests must check if values are <code>false</code> or
<code>nil</code>.</p>

<p>Taking the following test:</p>
<pre class="highlight ruby"><span class="n">val</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">if</span> <span class="n">val</span>
  <span class="k">return</span> <span class="mi">3</span><span class="o">.</span><span class="mi">142</span><span class="p">;</span>
<span class="k">end</span>
</pre>

<p>This would be compiled into:</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">!==</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span> <span class="o">!==</span> <span class="nx">nil</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mf">3.142</span><span class="p">;</span>
<span class="p">}</span>
</pre>

<p>This makes the generated truthy tests (<code>if</code> statements, <code>and</code> checks and
<code>or</code> statements) a litle more verbose in the generated code.</p>

<h2>Instance variables</h2>

<p>Instance variables in Opal work just as expected. When ivars are set or
retrieved on an object, they are set natively without the <code>@</code> prefix.
This allows real javascript identifiers to be used which is more
efficient then accessing variables by string name.</p>
<pre class="highlight ruby"><span class="vi">@foo</span> <span class="o">=</span> <span class="mi">200</span>
<span class="vi">@foo</span>  <span class="c1"># =&gt; 200</span>

<span class="vi">@bar</span>  <span class="c1"># =&gt; nil</span>
</pre>

<p>This gets compiled into:</p>
<pre class="highlight javascript"><span class="k">this</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>   <span class="c1">// =&gt; 200
</span>
<span class="k">this</span><span class="p">.</span><span class="nx">bar</span><span class="p">;</span>   <span class="c1">// =&gt; nil
</span></pre>

<h2>Compiled Files</h2>

<p>As described above, a compiled ruby source gets generated into a string
of javascript code that is wrapped inside an anonymous function. This
looks similar to the following:</p>
<pre class="highlight javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$opal</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$klass</span> <span class="o">=</span> <span class="nx">$opal</span><span class="p">.</span><span class="nx">klass</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">$opal</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
  <span class="c1">// generated code
</span><span class="p">})(</span><span class="nx">Opal</span><span class="p">);</span>
</pre>

<p>As a complete example, assuming the following code:</p>
<pre class="highlight ruby"><span class="nb">puts</span> <span class="s2">"foo"</span>
</pre>

<p>This would compile directly into:</p>
<pre class="highlight javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$opal</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$klass</span> <span class="o">=</span> <span class="nx">$opal</span><span class="p">.</span><span class="nx">klass</span><span class="p">,</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">$opal</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
  <span class="nx">self</span><span class="p">.</span><span class="nx">$puts</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">);</span>
<span class="p">})(</span><span class="nx">Opal</span><span class="p">);</span>
</pre>

<p>Most of the helpers are no longer present as they are not used in this
example.</p>

<h2>Using compiled sources</h2>

<p>If you write the generated code as above into a file <code>app.js</code> and add
that to your HTML page, then it is obvious that <code>&quot;foo&quot;</code> would be
written to the browser&#39;s console.</p>

<h2>Debugging and finding errors</h2>

<p>Because Opal does not aim to be fully compatible with ruby, there are
some instances where things can break and it may not be entirely
obvious what went wrong.</p>

<h3>Using javascript debuggers</h3>

<p>As opal just generates javascript, it is useful to use a native
debugger to work through javascript code. To use a debugger, simply
add an x-string similar to the following at the place you wish to
debug:</p>
<pre class="highlight ruby"><span class="c1"># .. code</span>
<span class="sb">`debugger`</span>
<span class="c1"># .. more code</span>
</pre>

<p>The x-strings just pass the debugger statement straight through to the
javascript output.</p>

<p>All local variables and method/block arguments also keep their ruby
names except in the rare cases when the name is reserved in javascript.
In these cases, a <code>$</code> suffix is added to the name (e.g. <code>try</code> =&gt;
<code>try$</code>).</p>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  <a href="/license"><i class="ion-unlocked"></i> License</a> ·
  <a href="https://github.com/opal/opal/graphs/contributors"><i class="ion-fork-repo"></i> Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
