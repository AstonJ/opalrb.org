<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Opal: Ruby to Javascript compiler</title>

  <link href="/stylesheets/application.css" rel="stylesheet" type="text/css" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" type="text/css" />
  <script src="/javascripts/application.js" type="text/javascript"></script>
</head>
<body class="docs docs_using_ruby_from_javascript docs_using_ruby_from_javascript_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png' style='margin-top:-10%;' width='22'>
        Opal
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='/try'>
            <i class='ion-ios7-compose'></i>
            Try
          </a>
        </li>
        <li>
          <a href='/blog'>
            <i class='ion-ios7-chatboxes'></i>
            Blog
          </a>
        </li>
        <li>
          <a href='/docs'>
            <i class='ion-ios7-copy'></i>
            Documentation
          </a>
        </li>
        <li>
          <a href='/libraries'>
            <i class='ion-android-developer'></i>
            Libraries
          </a>
        </li>
        <li>
          <a href='https://github.com/opal/opal#readme'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-md-3">
        <ul class="nav opal-sidebar">
          <li>
            <a href="/docs">Getting Started</a>
              <ul class="nav">
                <li><a href="/docs/rails">Rails</a></li>
                <li><a href="/docs/sinatra">Sinatra</a></li>
                <li><a href="/docs/using_sprockets">Sprockets</a></li>
                <li><a href="/docs/static_applications">Static Applications</a></li>
                <li><a href="/docs/cdn_distribution">CDN Distribution</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/api">API documentation</a>
          </li>
          <li>
            <a href="/docs/digging_deeper">Digging Deeper</a>
              <ul class="nav">
                <li><a href="/docs/interacting_with_javascript">Interacting with javascript</a></li>
                <li><a href="/docs/generated_javascript">Generated Code</a></li>
                <li><a href="/docs/method_missing"><tt>#method_missing</tt> support</a></li>
                <li><a href="/docs/using_ruby_from_javascript">Accessing Ruby methods</a></li>
                <li><a href="/docs/compiler">Compiler</a></li>
                <li><a href="/docs/source_maps">Source Maps</a></li>
                <li><a href="/docs/unsupported_features">Unsupported Features</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/libraries">Libraries</a>
              <ul class="nav">
                <li><a href="/docs/templates">Templates (Haml and ERB)</a></li>
                <li><a href="/docs/jquery">JQuery</a></li>
                <li><a href="/docs/rspec">RSpec</a></li>
                <li><a href="/docs/promises">Promises</a></li>
              </ul>
          </li>
          <li>
            <a href="/docs/faq">FAQ</a>
          </li>
        </ul>
      </div>

      <div class="col-md-9">
        <h1>Using Ruby methods from Javascript</h1>

<p>Accessing classes and methods defined in Opal from the javascript runtime is
possible via the <code>Opal</code> js object. The following class:</p>
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Foo</span>
  <span class="k">def</span> <span class="nf">bar</span>
    <span class="nb">puts</span> <span class="s2">"called bar on class Foo defined in ruby code"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Can be accessed from javascript like this:</p>
<pre><code class="highlight javascript"><span class="nx">Opal</span><span class="p">.</span><span class="nx">Foo</span><span class="p">.</span><span class="nx">$new</span><span class="p">().</span><span class="nx">$bar</span><span class="p">();</span>
<span class="c1">// =&gt; "called bar on class Foo defined in ruby code"</span>
</code></pre>

<p>Remember that all ruby methods are prefixed with a <code>$</code>.</p>

<p>In the case that a method name can&#39;t be called directly due to a javascript syntax error, you will need to call the method using bracket notation. For example, you can call <code>foo.$merge(...)</code> but not <code>foo.$merge!(...)</code>, <code>bar.$fetch(&#39;somekey&#39;)</code> but not <code>bar.$[](&#39;somekey&#39;)</code>. Instead you would write it like this: <code>foo[&#39;$merge!&#39;](...)</code> or <code>bar[&#39;$[]&#39;](&#39;somekey&#39;)</code>.</p>

<h2>Hash</h2>

<p>Since ruby hashes are implemented directly with an Opal class, there&#39;s no &quot;toll-free&quot; bridging available (unlike with strings and arrays, for example). However, it&#39;s quite possible to interact with hashes from Javascript:</p>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">myHash</span> <span class="o">=</span> <span class="nx">Opal</span><span class="p">.</span><span class="nx">hash</span><span class="p">({</span><span class="na">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="mi">2</span><span class="p">});</span>
<span class="c1">// output of $inspect: {"a"=&gt;1, "b"=&gt;2}</span>
<span class="nx">myHash</span><span class="p">.</span><span class="nx">$store</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">// output of $inspect: {"a"=&gt;10, "b"=&gt;2}</span>
<span class="nx">myHash</span><span class="p">.</span><span class="nx">$fetch</span><span class="p">(</span><span class="s1">'b'</span><span class="p">,</span><span class="s1">''</span><span class="p">);</span>
<span class="c1">// 2</span>
<span class="nx">myHash</span><span class="p">.</span><span class="nx">$fetch</span><span class="p">(</span><span class="s1">'z'</span><span class="p">,</span><span class="s1">''</span><span class="p">);</span>
<span class="c1">// ""</span>
<span class="nx">myHash</span><span class="p">.</span><span class="nx">$update</span><span class="p">(</span><span class="nx">Opal</span><span class="p">.</span><span class="nx">hash</span><span class="p">({</span><span class="na">b</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="na">c</span><span class="p">:</span> <span class="mi">30</span><span class="p">}));</span>
<span class="c1">// output of $inspect: {"a"=&gt;10, "b"=&gt;20, "c"=&gt;30}</span>
<span class="nx">myHash</span><span class="p">.</span><span class="nx">$to_n</span><span class="p">();</span> <span class="c1">// provided by the Native module</span>
<span class="c1">// output: {"a": 10, "b": 20, "c": 30} aka a standard Javascript object</span>
</code></pre>

<p>(Be aware to_n produces a duplicate copy of the hash.)</p>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  <a href="/license"><i class="ion-unlocked"></i> License</a> Â·
  <a href="https://github.com/opal/opal/graphs/contributors"><i class="ion-fork-repo"></i> Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
