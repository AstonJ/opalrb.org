<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Opal: Ruby to Javascript compiler</title>

  <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/application.js" type="text/javascript"></script>
</head>
<body>
  <nav class="navbar navbar-default opal-nav">
  <div class="container">

    <div class="navbar-header">
      <a class="navbar-brand" href="/">
        <img height='22' width='22' style='margin-top:-10%;' src='https://secure.gravatar.com/avatar/88298620949a6534d403da2e356c9339?s=420&d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-org-420.png'/>
        Opal
      </a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/docs">Documentation</a></li>
        <li><a href="/try">Try Opal now!</a></li>
        <li class="divider-vertical"></li>
        <li><p class="navbar-text"><span class="label label-info">integrations:</span></p></li>
        <li><a href="http://github.com/opal/opal-jquery">jQuery</a></li>
        <li><a href="https://github.com/opal/opal-rails#readme">Rails</a></li>
        <li><a href="https://github.com/opal/opal-rspec#readme">RSpec</a></li>
        <li><a href="https://github.com/opal/vienna#readme">Vienna</a></li>
        <li><a href="https://github.com/opal/opal-node#readme">Nodejs / RVM</a></li>
        <li><a href="https://github.com/opal/opal-todos#readme">TodoMVC</a></li>
      </ul>
    </div>

  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <ul class="nav nav-pills nav-stacked">
          <li><a href="/docs">Opal</a></li>
          <li><a href="/docs/getting_started">Getting Started</a></li>
          <li><a href="/docs/generated_javascript">Generated Code</a></li>
          <li><a href="/docs/method_missing">method_missing support</a></li>
          <li><a href="/docs/using_ruby_from_javascript">Accessing Ruby methods</a></li>
          <li><a href="/docs/using_sprockets">Sprockets Integration</a></li>
          <li><a href="/docs/static_applications">Building Static Apps</a></li>
        </ul>
      </div>

      <div class="col-md-9">
        <h1>Opal Compiler</h1>

<p>Opal is a source to source compiler. It accepts ruby code as a string and
generates javascript code which can be run in any environment. Generated
code relies on the opal runtime which provides the class system and some
other runtime helpers.</p>

<h2>Compiler stages</h2>

<p>The compiler can be broken down into 3 separate stages:</p>

<ul>
<li>lexing</li>
<li>parsing</li>
<li>code generation</li>
</ul>

<h3>Lexer</h3>

<p>The <a href="../lib/opal/parser/lexer.rb">opal lexer</a> is implemented in pure ruby using
the <code>StringScanner</code> class from the opal stdlib. The source code is scanned
and tokens are then provided to the parser. This process simply converts
the ruby code given as a string, into a list of tokens representing the
parts of the ruby code.</p>

<h3>Parser</h3>

<p>The <a href="../lib/opal/parser/grammar.y">opal parser</a> is implemented using a standard
bison like syntax, but relies on <code>racc</code>, a ruby implementation of yacc/bison
which is again available in the standard library. The parser takes these tokens
generated by the lexer and builds a syntax tree representing the ruby code.
This syntax tree is represented by <a href="../lib/opal/parser/sexp.rb">sexps</a>. As
ruby is such a complex and dynamic language, there is a lot of interaction
between the parser and the lexer, namely through a preserved <code>lex_state</code>.</p>

<h3>Code generation</h3>

<p>The <a href="../lib/opal/compiler.rb">opal compiler</a> takes these sexps from the parser
and generates ruby code from them. Each type of sexp has <a href="../lib/opal/nodes/base.rb">its own node type</a>
used to generate javascript. Each node creates an array of one or more
<a href="../lib/opal/fragment.rb">fragments</a> which are the concatendated together to
form the final javascript. Fragments are used as they contain the generated
code as well as a reference back to the original sexp which is useful for
generating source maps afterwards.</p>

      </div>
    </div>
  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<footer style='padding: 70px 0;
 margin-top: 70px;
 border-top: 1px solid
 #e5e5e5;
 background-color:
 #f5f5f5;text-align:center'>
     <a style="color: #888;" href="/license">License</a> â€¢
     <a style="color: #888;" href="https://github.com/opal/opal/graphs/contributors">Contributors</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')
  </script>
</body>
</html>
